{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://notmainstreet.local/schemas/target_integration_matrix.schema.json",
  "title": "TargetIntegrationMatrix",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "sources", "compatibility"],
  "properties": {
    "version": {"type": "integer", "minimum": 1},
    "sources": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kantian_ivi", "feigenbuam"],
      "properties": {
        "kantian_ivi": {"$ref": "#/$defs/target"},
        "feigenbuam": {"$ref": "#/$defs/target"}
      }
    },
    "compatibility": {
      "type": "object",
      "additionalProperties": false,
      "required": ["strict_mode", "breaking_change_policy", "supported_cdm_schema_versions"],
      "properties": {
        "strict_mode": {"type": "boolean"},
        "breaking_change_policy": {"type": "string", "minLength": 1},
        "supported_cdm_schema_versions": {
          "type": "array",
          "minItems": 1,
          "items": {"type": "string", "minLength": 1}
        }
      }
    }
  },
  "$defs": {
    "target": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "repository_url",
        "default_branch",
        "maintenance_status",
        "license",
        "default_mode",
        "pinned_commit",
        "git",
        "api_surface",
        "schema"
      ],
      "properties": {
        "repository_url": {"type": "string", "minLength": 1},
        "default_branch": {"type": "string", "minLength": 1},
        "maintenance_status": {"type": "string", "minLength": 1},
        "license": {"type": "string", "minLength": 1},
        "default_mode": {"type": "string", "enum": ["git", "api"]},
        "pinned_commit": {"type": "string", "minLength": 1},
        "git": {
          "type": "object",
          "additionalProperties": false,
          "required": ["artifact_root", "file_pattern", "branch"],
          "properties": {
            "artifact_root": {"type": "string", "minLength": 1},
            "file_pattern": {"type": "string", "minLength": 1},
            "branch": {"type": "string", "minLength": 1}
          }
        },
        "api_surface": {
          "type": "object",
          "additionalProperties": false,
          "required": ["mode", "endpoints"],
          "properties": {
            "mode": {"type": "string", "minLength": 1},
            "endpoints": {"type": "object"}
          }
        },
        "schema": {
          "type": "object",
          "additionalProperties": false,
          "required": ["format", "version", "location", "source_ref"],
          "properties": {
            "format": {"type": "string", "minLength": 1},
            "version": {"type": "string", "minLength": 1},
            "location": {"type": "string", "minLength": 1},
            "source_ref": {"type": "string", "minLength": 1}
          }
        }
      }
    }
  }
}
